<%
  # The index view will preload the first x number of images and the rest will use the unviel js plugin
  card_count = 0
  number_of_preloaded_images = 9
%>

<article class="level1">

  <% if @submissions && @submissions.any? %>
    <section class="row browse-index-header">
      <hgroup class="small-12 columns">
        <h1>
          <%= params[:grade].blank? ? 'All' : "#{params[:grade]}th Grade" %>
          <%= params[:category] unless params[:category].blank? %>
          Submissions
        </h1>
        <h2>
          <%= "in #{params[:area].gsub('+', ' ')}" unless params[:area].blank? %>
          <%= "#{@project} project" if @project %>
          <%= "taught by #{@instructor}" if @instructor %>
          &nbsp;
        </h2>
      </hgroup>
    </section>

    <section class="row small-up-1 medium-up-2 large-up-3 collapse work-cards">
      <% @submissions.each do |submission| %>

        <% submission.attachments.each do |attachment| %>
          <%
            card_count    += 1
            image         = attachment.file.url(:medium)
            default_image = (card_count <= number_of_preloaded_images ? image : 'loading-image.gif')
          %>
          <div class="columns work-card">
            <%= link_to browse_submission_path(submission, request.query_parameters), remote: @use_remote do %>
              <span class="image-wrapper">
                <%= image_tag(default_image, data: { src: image, src_retina: image}) %></span>
              <span class="title"><%= "#{submission.id}-#{attachment.id}" %> <%#= work_title(work) %></span>
              <span class="row">
                <span class="medium-4 columns medium-text-left text-center">Grade: <%= submission.data['Grade'] %></span>
                <span class="medium-8 columns medium-text-right text-center"><%= categories(submission) %></span>
              </span>
            <% end %>
          </div>

        <% end #.attachments.each %>
      <% end #submissions.each %>
    </section>
  <% else %>
    <section class="row">
      <div class="medium-10 small-offset-1 columns text-left">
        <div class="panel callout secondary radius">
          <h4>There is nothing to display</h4>
          <p>Try refining your search with the filters on the left</p>
        </div>
      </div>
    </section>
  <% end %>

</article>
